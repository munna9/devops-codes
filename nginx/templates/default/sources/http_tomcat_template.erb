#<%=@node['phenom']['banner']%>

upstream <%=@service_name%> {
<% @hosts.each do |host_name| %>
    server <%= host_name %>:<%=@application_port%>;
<% end %>
    keepalive <%=@keep_alive%>;
}
server {
  listen       <%=@service_port%>;
  server_name  <%=@uri%>;
  access_log   <%=@node['nginx']['app']['log_directory']%>/<%=@service_name%>-access.log;
  error_log    <%=@node['nginx']['app']['log_directory']%>/<%=@service_name%>-error.log;
  location / {
    return 302 <%=@context_name%>/;
  }

  location     <%=@context_name%>/ {
    proxy_pass              http://<%=@service_name%>;
    proxy_set_header        X-Forwarded-Host $host;
    proxy_set_header        X-Forwarded-Server $host;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version      1.1;
    proxy_connect_timeout   <%=@node['nginx']['conf']['proxy_connect_timeout']%>;
    proxy_send_timeout      <%=@node['nginx']['conf']['proxy_send_timeout']%>;
    proxy_read_timeout      <%=@node['nginx']['conf']['proxy_read_timeout']%>;
    send_timeout            <%=@node['nginx']['conf']['send_timeout']%>;
  }
}