#<%=@node['phenom']['banner']%>
upstream elastic_elb {
<% @hosts_array.each do |host_name| %>
  server <%= host_name %>:<%=node['elasticsearch']['server_port']%> max_fails=1  fail_timeout=5s;
<% end %>
  keepalive 15;
}
server {
  listen <%=node['elasticsearch']['elb_port']%>;
  server_name <%=node['elasticsearch']['elb_hostname']%>;
  access_log <%=@node['nginx']['app']['log_directory']%>/elastic_elb-access.log;
  error_log <%=@node['nginx']['app']['log_directory']%>/elastic_elb-error.log;
  client_max_body_size 0;
  location / {
    proxy_pass http://elastic_elb;
    proxy_redirect          off;
    proxy_next_upstream     error timeout invalid_header http_500 http_502 http_404;
    proxy_connect_timeout   2;
    proxy_http_version      1.1;
    proxy_set_header        Connection "Keep-Alive";
    proxy_set_header        Proxy-Connection "Keep-Alive";
    proxy_set_header        Host            $host;
    proxy_set_header        X-Real-IP       $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_next_upstream     error timeout invalid_header http_500;
  }
}
